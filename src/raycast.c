#include "raycast.h"
#include "framebuffer.h"
#include "config.h"
#include "maths.h"
#include <math.h>
#include <stdbool.h>

const fix16 sinLookup[ 360 ] = { FIX16(0.0), FIX16(0.0174524064373), FIX16(0.0348994967025), FIX16(0.0523359562429), FIX16(0.0697564737441), FIX16(0.0871557427477), FIX16(0.104528463268), FIX16(0.121869343405), FIX16(0.13917310096), FIX16(0.15643446504), FIX16(0.173648177667), FIX16(0.190808995377), FIX16(0.207911690818), FIX16(0.224951054344), FIX16(0.2419218956), FIX16(0.258819045103), FIX16(0.275637355817), FIX16(0.292371704723), FIX16(0.309016994375), FIX16(0.325568154457), FIX16(0.342020143326), FIX16(0.358367949545), FIX16(0.374606593416), FIX16(0.390731128489), FIX16(0.406736643076), FIX16(0.422618261741), FIX16(0.438371146789), FIX16(0.45399049974), FIX16(0.469471562786), FIX16(0.484809620246), FIX16(0.5), FIX16(0.51503807491), FIX16(0.529919264233), FIX16(0.544639035015), FIX16(0.559192903471), FIX16(0.573576436351), FIX16(0.587785252292), FIX16(0.601815023152), FIX16(0.615661475326), FIX16(0.62932039105), FIX16(0.642787609687), FIX16(0.656059028991), FIX16(0.669130606359), FIX16(0.681998360062), FIX16(0.694658370459), FIX16(0.707106781187), FIX16(0.719339800339), FIX16(0.731353701619), FIX16(0.743144825477), FIX16(0.754709580223), FIX16(0.766044443119), FIX16(0.777145961457), FIX16(0.788010753607), FIX16(0.798635510047), FIX16(0.809016994375), FIX16(0.819152044289), FIX16(0.829037572555), FIX16(0.838670567945), FIX16(0.848048096156), FIX16(0.857167300702), FIX16(0.866025403784), FIX16(0.874619707139), FIX16(0.882947592859), FIX16(0.891006524188), FIX16(0.898794046299), FIX16(0.906307787037), FIX16(0.913545457643), FIX16(0.920504853452), FIX16(0.927183854567), FIX16(0.933580426497), FIX16(0.939692620786), FIX16(0.945518575599), FIX16(0.951056516295), FIX16(0.956304755963), FIX16(0.961261695938), FIX16(0.965925826289), FIX16(0.970295726276), FIX16(0.974370064785), FIX16(0.978147600734), FIX16(0.981627183448), FIX16(0.984807753012), FIX16(0.987688340595), FIX16(0.990268068742), FIX16(0.992546151641), FIX16(0.994521895368), FIX16(0.996194698092), FIX16(0.99756405026), FIX16(0.998629534755), FIX16(0.999390827019), FIX16(0.999847695156), FIX16(1.0), FIX16(0.999847695156), FIX16(0.999390827019), FIX16(0.998629534755), FIX16(0.99756405026), FIX16(0.996194698092), FIX16(0.994521895368), FIX16(0.992546151641), FIX16(0.990268068742), FIX16(0.987688340595), FIX16(0.984807753012), FIX16(0.981627183448), FIX16(0.978147600734), FIX16(0.974370064785), FIX16(0.970295726276), FIX16(0.965925826289), FIX16(0.961261695938), FIX16(0.956304755963), FIX16(0.951056516295), FIX16(0.945518575599), FIX16(0.939692620786), FIX16(0.933580426497), FIX16(0.927183854567), FIX16(0.920504853452), FIX16(0.913545457643), FIX16(0.906307787037), FIX16(0.898794046299), FIX16(0.891006524188), FIX16(0.882947592859), FIX16(0.874619707139), FIX16(0.866025403784), FIX16(0.857167300702), FIX16(0.848048096156), FIX16(0.838670567945), FIX16(0.829037572555), FIX16(0.819152044289), FIX16(0.809016994375), FIX16(0.798635510047), FIX16(0.788010753607), FIX16(0.777145961457), FIX16(0.766044443119), FIX16(0.754709580223), FIX16(0.743144825477), FIX16(0.731353701619), FIX16(0.719339800339), FIX16(0.707106781187), FIX16(0.694658370459), FIX16(0.681998360062), FIX16(0.669130606359), FIX16(0.656059028991), FIX16(0.642787609687), FIX16(0.62932039105), FIX16(0.615661475326), FIX16(0.601815023152), FIX16(0.587785252292), FIX16(0.573576436351), FIX16(0.559192903471), FIX16(0.544639035015), FIX16(0.529919264233), FIX16(0.51503807491), FIX16(0.5), FIX16(0.484809620246), FIX16(0.469471562786), FIX16(0.45399049974), FIX16(0.438371146789), FIX16(0.422618261741), FIX16(0.406736643076), FIX16(0.390731128489), FIX16(0.374606593416), FIX16(0.358367949545), FIX16(0.342020143326), FIX16(0.325568154457), FIX16(0.309016994375), FIX16(0.292371704723), FIX16(0.275637355817), FIX16(0.258819045103), FIX16(0.2419218956), FIX16(0.224951054344), FIX16(0.207911690818), FIX16(0.190808995377), FIX16(0.173648177667), FIX16(0.15643446504), FIX16(0.13917310096), FIX16(0.121869343405), FIX16(0.104528463268), FIX16(0.0871557427477), FIX16(0.0697564737441), FIX16(0.0523359562429), FIX16(0.0348994967025), FIX16(0.0174524064373), FIX16(1.22464679915e-16), FIX16(-0.0174524064373), FIX16(-0.0348994967025), FIX16(-0.0523359562429), FIX16(-0.0697564737441), FIX16(-0.0871557427477), FIX16(-0.104528463268), FIX16(-0.121869343405), FIX16(-0.13917310096), FIX16(-0.15643446504), FIX16(-0.173648177667), FIX16(-0.190808995377), FIX16(-0.207911690818), FIX16(-0.224951054344), FIX16(-0.2419218956), FIX16(-0.258819045103), FIX16(-0.275637355817), FIX16(-0.292371704723), FIX16(-0.309016994375), FIX16(-0.325568154457), FIX16(-0.342020143326), FIX16(-0.358367949545), FIX16(-0.374606593416), FIX16(-0.390731128489), FIX16(-0.406736643076), FIX16(-0.422618261741), FIX16(-0.438371146789), FIX16(-0.45399049974), FIX16(-0.469471562786), FIX16(-0.484809620246), FIX16(-0.5), FIX16(-0.51503807491), FIX16(-0.529919264233), FIX16(-0.544639035015), FIX16(-0.559192903471), FIX16(-0.573576436351), FIX16(-0.587785252292), FIX16(-0.601815023152), FIX16(-0.615661475326), FIX16(-0.62932039105), FIX16(-0.642787609687), FIX16(-0.656059028991), FIX16(-0.669130606359), FIX16(-0.681998360062), FIX16(-0.694658370459), FIX16(-0.707106781187), FIX16(-0.719339800339), FIX16(-0.731353701619), FIX16(-0.743144825477), FIX16(-0.754709580223), FIX16(-0.766044443119), FIX16(-0.777145961457), FIX16(-0.788010753607), FIX16(-0.798635510047), FIX16(-0.809016994375), FIX16(-0.819152044289), FIX16(-0.829037572555), FIX16(-0.838670567945), FIX16(-0.848048096156), FIX16(-0.857167300702), FIX16(-0.866025403784), FIX16(-0.874619707139), FIX16(-0.882947592859), FIX16(-0.891006524188), FIX16(-0.898794046299), FIX16(-0.906307787037), FIX16(-0.913545457643), FIX16(-0.920504853452), FIX16(-0.927183854567), FIX16(-0.933580426497), FIX16(-0.939692620786), FIX16(-0.945518575599), FIX16(-0.951056516295), FIX16(-0.956304755963), FIX16(-0.961261695938), FIX16(-0.965925826289), FIX16(-0.970295726276), FIX16(-0.974370064785), FIX16(-0.978147600734), FIX16(-0.981627183448), FIX16(-0.984807753012), FIX16(-0.987688340595), FIX16(-0.990268068742), FIX16(-0.992546151641), FIX16(-0.994521895368), FIX16(-0.996194698092), FIX16(-0.99756405026), FIX16(-0.998629534755), FIX16(-0.999390827019), FIX16(-0.999847695156), FIX16(-1.0), FIX16(-0.999847695156), FIX16(-0.999390827019), FIX16(-0.998629534755), FIX16(-0.99756405026), FIX16(-0.996194698092), FIX16(-0.994521895368), FIX16(-0.992546151641), FIX16(-0.990268068742), FIX16(-0.987688340595), FIX16(-0.984807753012), FIX16(-0.981627183448), FIX16(-0.978147600734), FIX16(-0.974370064785), FIX16(-0.970295726276), FIX16(-0.965925826289), FIX16(-0.961261695938), FIX16(-0.956304755963), FIX16(-0.951056516295), FIX16(-0.945518575599), FIX16(-0.939692620786), FIX16(-0.933580426497), FIX16(-0.927183854567), FIX16(-0.920504853452), FIX16(-0.913545457643), FIX16(-0.906307787037), FIX16(-0.898794046299), FIX16(-0.891006524188), FIX16(-0.882947592859), FIX16(-0.874619707139), FIX16(-0.866025403784), FIX16(-0.857167300702), FIX16(-0.848048096156), FIX16(-0.838670567945), FIX16(-0.829037572555), FIX16(-0.819152044289), FIX16(-0.809016994375), FIX16(-0.798635510047), FIX16(-0.788010753607), FIX16(-0.777145961457), FIX16(-0.766044443119), FIX16(-0.754709580223), FIX16(-0.743144825477), FIX16(-0.731353701619), FIX16(-0.719339800339), FIX16(-0.707106781187), FIX16(-0.694658370459), FIX16(-0.681998360062), FIX16(-0.669130606359), FIX16(-0.656059028991), FIX16(-0.642787609687), FIX16(-0.62932039105), FIX16(-0.615661475326), FIX16(-0.601815023152), FIX16(-0.587785252292), FIX16(-0.573576436351), FIX16(-0.559192903471), FIX16(-0.544639035015), FIX16(-0.529919264233), FIX16(-0.51503807491), FIX16(-0.5), FIX16(-0.484809620246), FIX16(-0.469471562786), FIX16(-0.45399049974), FIX16(-0.438371146789), FIX16(-0.422618261741), FIX16(-0.406736643076), FIX16(-0.390731128489), FIX16(-0.374606593416), FIX16(-0.358367949545), FIX16(-0.342020143326), FIX16(-0.325568154457), FIX16(-0.309016994375), FIX16(-0.292371704723), FIX16(-0.275637355817), FIX16(-0.258819045103), FIX16(-0.2419218956), FIX16(-0.224951054344), FIX16(-0.207911690818), FIX16(-0.190808995377), FIX16(-0.173648177667), FIX16(-0.15643446504), FIX16(-0.13917310096), FIX16(-0.121869343405), FIX16(-0.104528463268), FIX16(-0.0871557427477), FIX16(-0.0697564737441), FIX16(-0.0523359562429), FIX16(-0.0348994967025), FIX16(-0.0174524064373) };
const fix16 cosLookup[ 360 ] = { FIX16(1.0), FIX16(0.999847695156), FIX16(0.999390827019), FIX16(0.998629534755), FIX16(0.99756405026), FIX16(0.996194698092), FIX16(0.994521895368), FIX16(0.992546151641), FIX16(0.990268068742), FIX16(0.987688340595), FIX16(0.984807753012), FIX16(0.981627183448), FIX16(0.978147600734), FIX16(0.974370064785), FIX16(0.970295726276), FIX16(0.965925826289), FIX16(0.961261695938), FIX16(0.956304755963), FIX16(0.951056516295), FIX16(0.945518575599), FIX16(0.939692620786), FIX16(0.933580426497), FIX16(0.927183854567), FIX16(0.920504853452), FIX16(0.913545457643), FIX16(0.906307787037), FIX16(0.898794046299), FIX16(0.891006524188), FIX16(0.882947592859), FIX16(0.874619707139), FIX16(0.866025403784), FIX16(0.857167300702), FIX16(0.848048096156), FIX16(0.838670567945), FIX16(0.829037572555), FIX16(0.819152044289), FIX16(0.809016994375), FIX16(0.798635510047), FIX16(0.788010753607), FIX16(0.777145961457), FIX16(0.766044443119), FIX16(0.754709580223), FIX16(0.743144825477), FIX16(0.731353701619), FIX16(0.719339800339), FIX16(0.707106781187), FIX16(0.694658370459), FIX16(0.681998360062), FIX16(0.669130606359), FIX16(0.656059028991), FIX16(0.642787609687), FIX16(0.62932039105), FIX16(0.615661475326), FIX16(0.601815023152), FIX16(0.587785252292), FIX16(0.573576436351), FIX16(0.559192903471), FIX16(0.544639035015), FIX16(0.529919264233), FIX16(0.51503807491), FIX16(0.5), FIX16(0.484809620246), FIX16(0.469471562786), FIX16(0.45399049974), FIX16(0.438371146789), FIX16(0.422618261741), FIX16(0.406736643076), FIX16(0.390731128489), FIX16(0.374606593416), FIX16(0.358367949545), FIX16(0.342020143326), FIX16(0.325568154457), FIX16(0.309016994375), FIX16(0.292371704723), FIX16(0.275637355817), FIX16(0.258819045103), FIX16(0.2419218956), FIX16(0.224951054344), FIX16(0.207911690818), FIX16(0.190808995377), FIX16(0.173648177667), FIX16(0.15643446504), FIX16(0.13917310096), FIX16(0.121869343405), FIX16(0.104528463268), FIX16(0.0871557427477), FIX16(0.0697564737441), FIX16(0.0523359562429), FIX16(0.0348994967025), FIX16(0.0174524064373), FIX16(6.12323399574e-17), FIX16(-0.0174524064373), FIX16(-0.0348994967025), FIX16(-0.0523359562429), FIX16(-0.0697564737441), FIX16(-0.0871557427477), FIX16(-0.104528463268), FIX16(-0.121869343405), FIX16(-0.13917310096), FIX16(-0.15643446504), FIX16(-0.173648177667), FIX16(-0.190808995377), FIX16(-0.207911690818), FIX16(-0.224951054344), FIX16(-0.2419218956), FIX16(-0.258819045103), FIX16(-0.275637355817), FIX16(-0.292371704723), FIX16(-0.309016994375), FIX16(-0.325568154457), FIX16(-0.342020143326), FIX16(-0.358367949545), FIX16(-0.374606593416), FIX16(-0.390731128489), FIX16(-0.406736643076), FIX16(-0.422618261741), FIX16(-0.438371146789), FIX16(-0.45399049974), FIX16(-0.469471562786), FIX16(-0.484809620246), FIX16(-0.5), FIX16(-0.51503807491), FIX16(-0.529919264233), FIX16(-0.544639035015), FIX16(-0.559192903471), FIX16(-0.573576436351), FIX16(-0.587785252292), FIX16(-0.601815023152), FIX16(-0.615661475326), FIX16(-0.62932039105), FIX16(-0.642787609687), FIX16(-0.656059028991), FIX16(-0.669130606359), FIX16(-0.681998360062), FIX16(-0.694658370459), FIX16(-0.707106781187), FIX16(-0.719339800339), FIX16(-0.731353701619), FIX16(-0.743144825477), FIX16(-0.754709580223), FIX16(-0.766044443119), FIX16(-0.777145961457), FIX16(-0.788010753607), FIX16(-0.798635510047), FIX16(-0.809016994375), FIX16(-0.819152044289), FIX16(-0.829037572555), FIX16(-0.838670567945), FIX16(-0.848048096156), FIX16(-0.857167300702), FIX16(-0.866025403784), FIX16(-0.874619707139), FIX16(-0.882947592859), FIX16(-0.891006524188), FIX16(-0.898794046299), FIX16(-0.906307787037), FIX16(-0.913545457643), FIX16(-0.920504853452), FIX16(-0.927183854567), FIX16(-0.933580426497), FIX16(-0.939692620786), FIX16(-0.945518575599), FIX16(-0.951056516295), FIX16(-0.956304755963), FIX16(-0.961261695938), FIX16(-0.965925826289), FIX16(-0.970295726276), FIX16(-0.974370064785), FIX16(-0.978147600734), FIX16(-0.981627183448), FIX16(-0.984807753012), FIX16(-0.987688340595), FIX16(-0.990268068742), FIX16(-0.992546151641), FIX16(-0.994521895368), FIX16(-0.996194698092), FIX16(-0.99756405026), FIX16(-0.998629534755), FIX16(-0.999390827019), FIX16(-0.999847695156), FIX16(-1.0), FIX16(-0.999847695156), FIX16(-0.999390827019), FIX16(-0.998629534755), FIX16(-0.99756405026), FIX16(-0.996194698092), FIX16(-0.994521895368), FIX16(-0.992546151641), FIX16(-0.990268068742), FIX16(-0.987688340595), FIX16(-0.984807753012), FIX16(-0.981627183448), FIX16(-0.978147600734), FIX16(-0.974370064785), FIX16(-0.970295726276), FIX16(-0.965925826289), FIX16(-0.961261695938), FIX16(-0.956304755963), FIX16(-0.951056516295), FIX16(-0.945518575599), FIX16(-0.939692620786), FIX16(-0.933580426497), FIX16(-0.927183854567), FIX16(-0.920504853452), FIX16(-0.913545457643), FIX16(-0.906307787037), FIX16(-0.898794046299), FIX16(-0.891006524188), FIX16(-0.882947592859), FIX16(-0.874619707139), FIX16(-0.866025403784), FIX16(-0.857167300702), FIX16(-0.848048096156), FIX16(-0.838670567945), FIX16(-0.829037572555), FIX16(-0.819152044289), FIX16(-0.809016994375), FIX16(-0.798635510047), FIX16(-0.788010753607), FIX16(-0.777145961457), FIX16(-0.766044443119), FIX16(-0.754709580223), FIX16(-0.743144825477), FIX16(-0.731353701619), FIX16(-0.719339800339), FIX16(-0.707106781187), FIX16(-0.694658370459), FIX16(-0.681998360062), FIX16(-0.669130606359), FIX16(-0.656059028991), FIX16(-0.642787609687), FIX16(-0.62932039105), FIX16(-0.615661475326), FIX16(-0.601815023152), FIX16(-0.587785252292), FIX16(-0.573576436351), FIX16(-0.559192903471), FIX16(-0.544639035015), FIX16(-0.529919264233), FIX16(-0.51503807491), FIX16(-0.5), FIX16(-0.484809620246), FIX16(-0.469471562786), FIX16(-0.45399049974), FIX16(-0.438371146789), FIX16(-0.422618261741), FIX16(-0.406736643076), FIX16(-0.390731128489), FIX16(-0.374606593416), FIX16(-0.358367949545), FIX16(-0.342020143326), FIX16(-0.325568154457), FIX16(-0.309016994375), FIX16(-0.292371704723), FIX16(-0.275637355817), FIX16(-0.258819045103), FIX16(-0.2419218956), FIX16(-0.224951054344), FIX16(-0.207911690818), FIX16(-0.190808995377), FIX16(-0.173648177667), FIX16(-0.15643446504), FIX16(-0.13917310096), FIX16(-0.121869343405), FIX16(-0.104528463268), FIX16(-0.0871557427477), FIX16(-0.0697564737441), FIX16(-0.0523359562429), FIX16(-0.0348994967025), FIX16(-0.0174524064373), FIX16(-1.83697019872e-16), FIX16(0.0174524064373), FIX16(0.0348994967025), FIX16(0.0523359562429), FIX16(0.0697564737441), FIX16(0.0871557427477), FIX16(0.104528463268), FIX16(0.121869343405), FIX16(0.13917310096), FIX16(0.15643446504), FIX16(0.173648177667), FIX16(0.190808995377), FIX16(0.207911690818), FIX16(0.224951054344), FIX16(0.2419218956), FIX16(0.258819045103), FIX16(0.275637355817), FIX16(0.292371704723), FIX16(0.309016994375), FIX16(0.325568154457), FIX16(0.342020143326), FIX16(0.358367949545), FIX16(0.374606593416), FIX16(0.390731128489), FIX16(0.406736643076), FIX16(0.422618261741), FIX16(0.438371146789), FIX16(0.45399049974), FIX16(0.469471562786), FIX16(0.484809620246), FIX16(0.5), FIX16(0.51503807491), FIX16(0.529919264233), FIX16(0.544639035015), FIX16(0.559192903471), FIX16(0.573576436351), FIX16(0.587785252292), FIX16(0.601815023152), FIX16(0.615661475326), FIX16(0.62932039105), FIX16(0.642787609687), FIX16(0.656059028991), FIX16(0.669130606359), FIX16(0.681998360062), FIX16(0.694658370459), FIX16(0.707106781187), FIX16(0.719339800339), FIX16(0.731353701619), FIX16(0.743144825477), FIX16(0.754709580223), FIX16(0.766044443119), FIX16(0.777145961457), FIX16(0.788010753607), FIX16(0.798635510047), FIX16(0.809016994375), FIX16(0.819152044289), FIX16(0.829037572555), FIX16(0.838670567945), FIX16(0.848048096156), FIX16(0.857167300702), FIX16(0.866025403784), FIX16(0.874619707139), FIX16(0.882947592859), FIX16(0.891006524188), FIX16(0.898794046299), FIX16(0.906307787037), FIX16(0.913545457643), FIX16(0.920504853452), FIX16(0.927183854567), FIX16(0.933580426497), FIX16(0.939692620786), FIX16(0.945518575599), FIX16(0.951056516295), FIX16(0.956304755963), FIX16(0.961261695938), FIX16(0.965925826289), FIX16(0.970295726276), FIX16(0.974370064785), FIX16(0.978147600734), FIX16(0.981627183448), FIX16(0.984807753012), FIX16(0.987688340595), FIX16(0.990268068742), FIX16(0.992546151641), FIX16(0.994521895368), FIX16(0.996194698092), FIX16(0.99756405026), FIX16(0.998629534755), FIX16(0.999390827019), FIX16(0.999847695156) };
const fix16 tanLookup[ 360 ] = { FIX16(0.0), FIX16(0.0174550649282), FIX16(0.0349207694917), FIX16(0.052407779283), FIX16(0.0699268119435), FIX16(0.0874886635259), FIX16(0.105104235266), FIX16(0.122784560903), FIX16(0.140540834702), FIX16(0.158384440325), FIX16(0.176326980708), FIX16(0.194380309138), FIX16(0.21255656167), FIX16(0.230868191126), FIX16(0.249328002843), FIX16(0.267949192431), FIX16(0.286745385759), FIX16(0.305730681459), FIX16(0.324919696233), FIX16(0.34432761329), FIX16(0.363970234266), FIX16(0.383864035035), FIX16(0.404026225835), FIX16(0.42447481621), FIX16(0.445228685309), FIX16(0.466307658155), FIX16(0.487732588566), FIX16(0.509525449494), FIX16(0.531709431661), FIX16(0.554309051453), FIX16(0.57735026919), FIX16(0.600860619028), FIX16(0.624869351909), FIX16(0.649407593198), FIX16(0.674508516842), FIX16(0.70020753821), FIX16(0.726542528005), FIX16(0.753554050103), FIX16(0.781285626507), FIX16(0.809784033195), FIX16(0.839099631177), FIX16(0.869286737816), FIX16(0.900404044298), FIX16(0.932515086138), FIX16(0.965688774807), FIX16(1.0), FIX16(1.03553031379), FIX16(1.07236871002), FIX16(1.11061251483), FIX16(1.15036840722), FIX16(1.19175359259), FIX16(1.23489715654), FIX16(1.27994163219), FIX16(1.32704482162), FIX16(1.37638192047), FIX16(1.42814800674), FIX16(1.48256096851), FIX16(1.53986496381), FIX16(1.60033452904), FIX16(1.66427948235), FIX16(1.73205080757), FIX16(1.80404775527), FIX16(1.88072646535), FIX16(1.96261050551), FIX16(2.05030384158), FIX16(2.14450692051), FIX16(2.2460367739), FIX16(2.35585236582), FIX16(2.47508685342), FIX16(2.60508906469), FIX16(2.74747741945), FIX16(2.90421087768), FIX16(3.07768353718), FIX16(3.27085261848), FIX16(3.48741444384), FIX16(3.73205080757), FIX16(4.01078093354), FIX16(4.33147587428), FIX16(4.70463010948), FIX16(5.14455401597), FIX16(5.67128181962), FIX16(6.31375151468), FIX16(7.11536972238), FIX16(8.14434642797), FIX16(9.51436445422), FIX16(11.4300523028), FIX16(14.3006662567), FIX16(19.0811366877), FIX16(28.6362532829), FIX16(57.2899616308), FIX16(1.63312393532e+16), FIX16(-57.2899616308), FIX16(-28.6362532829), FIX16(-19.0811366877), FIX16(-14.3006662567), FIX16(-11.4300523028), FIX16(-9.51436445422), FIX16(-8.14434642797), FIX16(-7.11536972238), FIX16(-6.31375151468), FIX16(-5.67128181962), FIX16(-5.14455401597), FIX16(-4.70463010948), FIX16(-4.33147587428), FIX16(-4.01078093354), FIX16(-3.73205080757), FIX16(-3.48741444384), FIX16(-3.27085261848), FIX16(-3.07768353718), FIX16(-2.90421087768), FIX16(-2.74747741945), FIX16(-2.60508906469), FIX16(-2.47508685342), FIX16(-2.35585236582), FIX16(-2.2460367739), FIX16(-2.14450692051), FIX16(-2.05030384158), FIX16(-1.96261050551), FIX16(-1.88072646535), FIX16(-1.80404775527), FIX16(-1.73205080757), FIX16(-1.66427948235), FIX16(-1.60033452904), FIX16(-1.53986496381), FIX16(-1.48256096851), FIX16(-1.42814800674), FIX16(-1.37638192047), FIX16(-1.32704482162), FIX16(-1.27994163219), FIX16(-1.23489715654), FIX16(-1.19175359259), FIX16(-1.15036840722), FIX16(-1.11061251483), FIX16(-1.07236871002), FIX16(-1.03553031379), FIX16(-1.0), FIX16(-0.965688774807), FIX16(-0.932515086138), FIX16(-0.900404044298), FIX16(-0.869286737816), FIX16(-0.839099631177), FIX16(-0.809784033195), FIX16(-0.781285626507), FIX16(-0.753554050103), FIX16(-0.726542528005), FIX16(-0.70020753821), FIX16(-0.674508516842), FIX16(-0.649407593198), FIX16(-0.624869351909), FIX16(-0.600860619028), FIX16(-0.57735026919), FIX16(-0.554309051453), FIX16(-0.531709431661), FIX16(-0.509525449494), FIX16(-0.487732588566), FIX16(-0.466307658155), FIX16(-0.445228685309), FIX16(-0.42447481621), FIX16(-0.404026225835), FIX16(-0.383864035035), FIX16(-0.363970234266), FIX16(-0.34432761329), FIX16(-0.324919696233), FIX16(-0.305730681459), FIX16(-0.286745385759), FIX16(-0.267949192431), FIX16(-0.249328002843), FIX16(-0.230868191126), FIX16(-0.21255656167), FIX16(-0.194380309138), FIX16(-0.176326980708), FIX16(-0.158384440325), FIX16(-0.140540834702), FIX16(-0.122784560903), FIX16(-0.105104235266), FIX16(-0.0874886635259), FIX16(-0.0699268119435), FIX16(-0.052407779283), FIX16(-0.0349207694917), FIX16(-0.0174550649282), FIX16(-1.22464679915e-16), FIX16(0.0174550649282), FIX16(0.0349207694917), FIX16(0.052407779283), FIX16(0.0699268119435), FIX16(0.0874886635259), FIX16(0.105104235266), FIX16(0.122784560903), FIX16(0.140540834702), FIX16(0.158384440325), FIX16(0.176326980708), FIX16(0.194380309138), FIX16(0.21255656167), FIX16(0.230868191126), FIX16(0.249328002843), FIX16(0.267949192431), FIX16(0.286745385759), FIX16(0.305730681459), FIX16(0.324919696233), FIX16(0.34432761329), FIX16(0.363970234266), FIX16(0.383864035035), FIX16(0.404026225835), FIX16(0.42447481621), FIX16(0.445228685309), FIX16(0.466307658155), FIX16(0.487732588566), FIX16(0.509525449494), FIX16(0.531709431661), FIX16(0.554309051453), FIX16(0.57735026919), FIX16(0.600860619028), FIX16(0.624869351909), FIX16(0.649407593198), FIX16(0.674508516842), FIX16(0.70020753821), FIX16(0.726542528005), FIX16(0.753554050103), FIX16(0.781285626507), FIX16(0.809784033195), FIX16(0.839099631177), FIX16(0.869286737816), FIX16(0.900404044298), FIX16(0.932515086138), FIX16(0.965688774807), FIX16(1.0), FIX16(1.03553031379), FIX16(1.07236871002), FIX16(1.11061251483), FIX16(1.15036840722), FIX16(1.19175359259), FIX16(1.23489715654), FIX16(1.27994163219), FIX16(1.32704482162), FIX16(1.37638192047), FIX16(1.42814800674), FIX16(1.48256096851), FIX16(1.53986496381), FIX16(1.60033452904), FIX16(1.66427948235), FIX16(1.73205080757), FIX16(1.80404775527), FIX16(1.88072646535), FIX16(1.96261050551), FIX16(2.05030384158), FIX16(2.14450692051), FIX16(2.2460367739), FIX16(2.35585236582), FIX16(2.47508685342), FIX16(2.60508906469), FIX16(2.74747741945), FIX16(2.90421087768), FIX16(3.07768353718), FIX16(3.27085261848), FIX16(3.48741444384), FIX16(3.73205080757), FIX16(4.01078093354), FIX16(4.33147587428), FIX16(4.70463010948), FIX16(5.14455401597), FIX16(5.67128181962), FIX16(6.31375151468), FIX16(7.11536972238), FIX16(8.14434642797), FIX16(9.51436445422), FIX16(11.4300523028), FIX16(14.3006662567), FIX16(19.0811366877), FIX16(28.6362532829), FIX16(57.2899616308), FIX16(5.44374645107e+15), FIX16(-57.2899616308), FIX16(-28.6362532829), FIX16(-19.0811366877), FIX16(-14.3006662567), FIX16(-11.4300523028), FIX16(-9.51436445422), FIX16(-8.14434642797), FIX16(-7.11536972238), FIX16(-6.31375151468), FIX16(-5.67128181962), FIX16(-5.14455401597), FIX16(-4.70463010948), FIX16(-4.33147587428), FIX16(-4.01078093354), FIX16(-3.73205080757), FIX16(-3.48741444384), FIX16(-3.27085261848), FIX16(-3.07768353718), FIX16(-2.90421087768), FIX16(-2.74747741945), FIX16(-2.60508906469), FIX16(-2.47508685342), FIX16(-2.35585236582), FIX16(-2.2460367739), FIX16(-2.14450692051), FIX16(-2.05030384158), FIX16(-1.96261050551), FIX16(-1.88072646535), FIX16(-1.80404775527), FIX16(-1.73205080757), FIX16(-1.66427948235), FIX16(-1.60033452904), FIX16(-1.53986496381), FIX16(-1.48256096851), FIX16(-1.42814800674), FIX16(-1.37638192047), FIX16(-1.32704482162), FIX16(-1.27994163219), FIX16(-1.23489715654), FIX16(-1.19175359259), FIX16(-1.15036840722), FIX16(-1.11061251483), FIX16(-1.07236871002), FIX16(-1.03553031379), FIX16(-1.0), FIX16(-0.965688774807), FIX16(-0.932515086138), FIX16(-0.900404044298), FIX16(-0.869286737816), FIX16(-0.839099631177), FIX16(-0.809784033195), FIX16(-0.781285626507), FIX16(-0.753554050103), FIX16(-0.726542528005), FIX16(-0.70020753821), FIX16(-0.674508516842), FIX16(-0.649407593198), FIX16(-0.624869351909), FIX16(-0.600860619028), FIX16(-0.57735026919), FIX16(-0.554309051453), FIX16(-0.531709431661), FIX16(-0.509525449494), FIX16(-0.487732588566), FIX16(-0.466307658155), FIX16(-0.445228685309), FIX16(-0.42447481621), FIX16(-0.404026225835), FIX16(-0.383864035035), FIX16(-0.363970234266), FIX16(-0.34432761329), FIX16(-0.324919696233), FIX16(-0.305730681459), FIX16(-0.286745385759), FIX16(-0.267949192431), FIX16(-0.249328002843), FIX16(-0.230868191126), FIX16(-0.21255656167), FIX16(-0.194380309138), FIX16(-0.176326980708), FIX16(-0.158384440325), FIX16(-0.140540834702), FIX16(-0.122784560903), FIX16(-0.105104235266), FIX16(-0.0874886635259), FIX16(-0.0699268119435), FIX16(-0.052407779283), FIX16(-0.0349207694917), FIX16(-0.0174550649282) };

const u8 worldMap[ mapWidth ][ mapHeight ] = {
  {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
  {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,0,0,0,0,0,2,2,2,2,2,0,0,0,0,3,0,3,0,3,0,0,0,1},
  {1,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,0,0,0,0,0,2,0,0,0,2,0,0,0,0,3,0,0,0,3,0,0,0,1},
  {1,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,0,0,0,0,0,2,2,0,2,2,0,0,0,0,3,0,3,0,3,0,0,0,1},
  {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,4,0,4,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,4,0,0,0,0,5,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,4,0,4,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,4,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
  {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}
};

static Vect2D_u16 position = { 96, 96 };
static u16 directionAngle;
// If not up, then down.
static bool up = false;
// If not right, then left.
static bool right = false;

void gtRaycasterFrame() {
  // todo draw background here
  u16 rayAngle = ( directionAngle + 30 ) % 360;

  // Ray will draw from directionAngle + 30 to directionAngle - 30 (60 degree fov)
  for( u16 column = 0; column != ScreenX; column++ ) {
    up = fix16ToInt( sinLookup[ column ] ) > 0;
    right = fix16ToInt( cosLookup[ column ] ) > 0;

    Vect2D_s16 step = { 0, 0 };

    // Check horizontal intersections
    Vect2D_s16 horizInt = { 0, 0 };
    if( up ) {
      horizInt.y = ( position.y / TileSize ) * TileSize - 1;
      step.y = -TileSize;
    } else {
      horizInt.y = ( position.y / TileSize ) * TileSize + 64;
      step.y = TileSize;
    }

  }
}
